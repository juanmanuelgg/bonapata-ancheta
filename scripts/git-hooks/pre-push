#!/bin/bash
set -x

# Run Unit tests & Build the library jars
./gradlew clean build

# Clean the docs directory from autogenerated files
rm -rf docs/javadoc && rm -rf docs/test

# Copy the javadoc to the docs folder to host it online in github-pages
./gradlew copy

if test $(git diff --name-only dist | wc -l) != 0
then
	cat <<\EOF
Error: Not all the tracked files were ready for a push.

Maybe you were intentionally letting dist/ behind.

dist/ is tracked so the project could be imported from github.

If you know what you are doing you can disable this check using:

  git push --no-verify
EOF
	exit 1
fi